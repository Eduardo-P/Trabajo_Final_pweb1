<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="UTF-8">
        <title>New Web</title>
    </head>
    <body>
        <div id="usuario"></div>
        <form id="new" method="post" action="/cgi-bin/new.pl">
            <input type="hidden" name="owner" id="owner" value="">
            <table>
                <tr>
                    <td> <h4><label for="titulo">Título:</label></h4> </td>
                    <td>
                        <input type="text" name="title" id="titulo" value="" size="52" style="padding-bottom: 10px"/>
                    </td>
                </tr>
                <tr>
                    <td> <h4><label for="markdown">Texto:</label></h4> </td>
                    <td>
                        <textarea id="markdown" name="text" value="" size="90" rows="10" cols="50" style="padding-bottom: 10px"></textarea>
                    </td>
                </tr>
            </table>
            <input type="submit" value="Enviar">
        </form>
        <p> <a id="listPagina" href="http://localhost/list.html"> Cancelar </a> </p>
        
        <div id="result" class="hidden">
            <div id="estructura" class="contenidoXML">
              <h4>FORMATO XML</h4>
              <pre id="content"></pre>
            </div>
        </div>
    </body>
    <script>
        var parametros = new URLSearchParams(window.location.search);
        var owner = parametros.get('owner');

        document.getElementById("usuario").innerHTML = owner;

        document.getElementById("owner").value = owner;

        var enlace = document.getElementById("listPagina");
        enlace.href = enlace.href + "?owner=" + owner;



        document.getElementById("new").addEventListener("submit", function(event) {
            event.preventDefault();

            var form = event.target;
            var formData = new FormData(form);

            fetch(form.action, {
                method: form.method,
                body: formData
            })
            .then(response => response.text())
            .then(xmlData => {
                var parser = new DOMParser();
                var xmlDoc = parser.parseFromString(xmlData, "text/xml");

                // Verificar si el XML contiene elementos <title> y <text>
                var titleElement = xmlDoc.querySelector('title');
                var textElement = xmlDoc.querySelector('text');

                if (titleElement && textElement) {
                  // Primera forma: Dirección a new.pl con parámetros title y text
                  var titleValue = titleElement.textContent;
                  var textValue = textElement.textContent;
                  window.location.href = "/cgi-bin/viewMarkdown.pl?owner=" + encodeURIComponent(owner) +"&title=" + encodeURIComponent(titleValue) + "&text=" + encodeURIComponent(textValue);
                } else {
                  // Segunda forma: Mostrar mensaje en el elemento con id "content"
                  document.getElementById("content").textContent = "No se pudo guardar el artículo!";
                  document.getElementById("result").classList.remove("hidden");
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
        });
    </script>
    <script>/*
        document.getElementById("new").addEventListener("submit", function(event) {
          event.preventDefault();
      
          var form = event.target;
          var formData = new FormData(form);
      
          fetch(form.action, {
            method: form.method,
            body: formData
          })
          .then(response => response.text())
          .then(xmlData => {
            document.getElementById("content").textContent = xmlData;
            document.getElementById("result").classList.remove("hidden");
          })
          .catch(error => {
            console.error('Error:', error);
          });
        });*/
    </script>
    <script>
        

    </script>
    <script>/*
        function handleSubmit(event, formId) {
          event.preventDefault();
      
          var form = event.target;
          var formData = new FormData(form);
      
          fetch(form.action, {
            method: form.method,
            body: formData
          })
          .then(response => response.text())
          .then(xmlData => {
            document.getElementById("content").textContent = xmlData;
            document.getElementById("result").classList.remove("hidden");
          })
          .catch(error => {
            console.error('Error:', error);
          });
        }
      
        document.getElementById("loginForm").addEventListener("submit", function(event) {
          handleSubmit(event, "loginForm");
        });
      
        document.getElementById("signupForm").addEventListener("submit", function(event) {
          handleSubmit(event, "signupForm");
        });*/
    </script>
</html>